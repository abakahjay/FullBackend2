<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AfroDataGH</title>
  <link rel="shortcut icon" href="/static/favicon.ico" type="image/x-icon">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" /> -->
  <link
        rel="stylesheet"
        href="/font-awesome/css/all.min.css"
    />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f5f5;
      color: #333;
      font-size: 14px;
    }

    header {
      background-color: #fff;
      color: #111;
      padding: 1.5rem 1.5rem;
      font-size: 1.2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ddd;
    }

    .header-left {
      display: flex;
      align-items: center;
    }

    .hamburger {
      width: 16px;
      height: 16px;
      margin-left: 20px;
      margin-right: 20px;
      cursor: pointer;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .notification,
    .avatar {
      width: 24px;
      height: 24px;
      cursor: pointer;
      border-radius: 50%;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    nav.collapsed {
      display: none;
    }

    @media (max-width: 768px) {
      nav.collapsed {
        display: none;
      }
    }

    nav {
      background-color: #f8f9fa;
      width: 220px;
      padding: 1rem 0.5rem;
      flex-shrink: 0;
      border-right: 1px solid #ddd;
      display: flex;
      flex-direction: column;
    }

    .sidebar-title {
      font-size: 0.75rem;
      font-weight: bold;
      color: #888;
      padding: 0.5rem 1rem;
    }

    .sidebar-menu {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar-menu li {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      gap: 10px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      font-size: 0.9rem;
      color: #111;
    }

    .sidebar-menu li:hover {
      background-color: #e2e6ea;
    }

    .sidebar-avatars {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 1rem 0;
      border-bottom: 1px solid #ddd;
    }

    .sidebar-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
    }

    .avatar-label {
      font-size: 0.8rem;
      color: #555;
      margin-top: 2px;
      text-align: center;
    }

    main {
      flex-grow: 1;
      padding: 1rem 2rem;
      overflow-x: auto;
    }

    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 1rem;
    }

    .tabs button {
      padding: 0.4rem 0.8rem;
      border: none;
      background: #e4e4e4;
      cursor: pointer;
      border-radius: 5px;
      transition: 0.3s;
    }

    .tabs button.active {
      background: #007bff;
      color: white;
    }

    .actions {
      display: flex;
      gap: 10px;
      margin-bottom: 1rem;
    }

    .actions button {
      padding: 0.4rem 0.8rem;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      font-size: 13px;
    }

    .btn-download {
      background-color: #dc3545;
    }

    .btn-bulk {
      background-color: #ffc107;
      color: black;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th,
    td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: center;
    }

    th {
      background-color: #f0f0f0;
    }

    .badge {
      padding: 3px 8px;
      border-radius: 5px;
      font-size: 0.8rem;
      display: inline-block;
    }

    .status-pending {
      background-color: #ffc107;
      color: white;
    }

    .status-declined {
      background-color: #dc3545;
      color: white;
    }
    .status-failed {
      background-color: #dc3545;
      color: white;
    }
    .status-completed {
      background-color: #28a745;
    }

    .status-delivered {
  background-color: #28a745; /* üçã lemon green */
  color: white;
}


    .sidebar-menu li.active {
      background-color: #e2e6ea;
      font-weight: bold;
    }


    .btn-perform {
      background-color: #28a745;
      color: white;
      padding: 4px 8px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      nav {
        width: 100%;
        flex-direction: row;
        justify-content: space-around;
      }

      .actions {
        flex-direction: column;
      }
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      nav {
        width: 100%;
        flex-direction: column;
      }
    }

    .sidebar-menu li {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 15px;
    }

    .sidebar-menu li i {
      width: 20px;
      font-size: 1rem;
    }

    .header-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
      gap: 10px;
    }

    .header-controls .tabs {
      flex-wrap: wrap;
      display: flex;
      gap: 10px;
    }

    .header-controls .actions {
      display: flex;
      gap: 10px;
    }

    @media (max-width: 768px) {
      .header-controls {
        flex-direction: column;
        align-items: stretch;
      }

      .header-controls .actions {
        flex-direction: column;
        width: 100%;
      }

      .header-controls .tabs {
        justify-content: center;
      }
    }

    /* === Fix header and sidebar === */

/* Make the header fixed */
header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  height: 60px;
  padding: 0 1.5rem;
  background-color: #fff;
  border-bottom: 1px solid #ddd;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* Push the container down below the header */
.container {
  margin-top: 60px; /* equal to header height */
}

/* Fix the sidebar on large screens */
@media (min-width: 769px) {
  nav {
    position: fixed;
    top: 60px;
    left: 0;
    bottom: 0;
    width: 220px;
    height: calc(100% - 60px);
    overflow-y: auto;
    z-index: 999;
  }

  main {
  margin-left: 220px;
  transition: margin-left 0.3s ease;
}

main.collapsed {
  margin-left: 0;
}
}

/* Mobile sidebar toggle */
@media (max-width: 768px) {
  /* nav { */
    /* position: fixed; */
    /* top: 60px; */
    /* left: 0; */
    /* right: 0; */
    /* height: calc(100% - 60px); */
    /* background: #f8f9fa; */
    /* z-index: 999; */
    /* display: none; */
  /* } */

  nav.active {
    display: flex !important;
    flex-direction: column;
  }

  main {
    margin-left: 0;
  }

  .hamburger {
    display: block;
    font-size: 1.5rem;
    background: none;
    border: none;
    cursor: pointer;
  }
}







    
  </style>
</head>

<body>
  <header>
    <div class="header-left">
      <span>AFRODATAGH</span>
      <svg class="hamburger" viewBox="0 0 100 80" fill="#333">
        <rect width="100" height="10"></rect>
        <rect y="30" width="100" height="10"></rect>
        <rect y="60" width="100" height="10"></rect>
      </svg>
    </div>
    <div class="header-right">
      <i class="fa-solid fa-power-off notification" onclick="logout()" style="cursor:pointer;"></i>
      <!-- <img src="https://www.gravatar.com/avatar?d=mp" alt="Admin" class="avatar" /> -->
      <div style="display: flex; align-items: center; gap: 10px;justify-content: center;" >
        <!-- <img id="profile-pic" src="https://www.gravatar.com/avatar?d=mp" alt="Admin" class="avatar" /> -->
        <span id="user-role-text" style="font-weight: bold;"></span>
      </div>
      <p id="upload-statuss" style="font-size: 12px; color: #666;"></p>

    </div>
  </header>
  <div class="container">
    <nav>
      <div class="sidebar-title">MENU</div>

      <ul class="sidebar-menu">
        <li onclick="showSection('orders')">
          <i class="fa fa-clock"></i>
          <span>Orders</span>
        </li>
        <li onclick="showSection('users')">
          <i class="fa fa-user"></i>
          <span>Users</span>
        </li>

      </ul>


    </nav>
    <main>
      <h2 id="section-header" style="margin-top: 1rem;">Orders</h2>


      <!-- Orders Table -->
      <div id="ordersSection">
        <div class="header-controls">
          <div class="tabs">
            <button class="active">All</button>
            <button>Completed</button>
            <button>Pending</button>
            <button>Failed</button>
          </div>
          <div class="actions">
            <button class="btn-download" onclick="downloadOrders()">Download MTN Orders</button>
            <button class="btn-bulk" onclick="bulkVerify()">Bulk Verify</button>
          </div>
        </div>

        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Recipient</th>
              <th>Quantity</th>
              <th>Network</th>
              <th>Price</th>
              <th>Payment</th>
              <th>Status</th>
              <th>Updated</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="orderTable"></tbody>
        </table>
      </div>

      <!-- Users Table -->
      <div id="usersSection" style="display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h3></h3>
          <button class="btn-bulk" onclick="showModal()">Add User</button>
        </div>
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Name</th>
              <th>Email</th>
              <th>Telephone</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="userTable"></tbody>
        </table>
      </div>

      <!-- Spinner -->
      <div id="loadingSpinner" style="display: none; text-align: center; margin: 20px 0;">
        <i class="fa fa-spinner fa-spin" style="font-size: 24px; color: #007bff;"></i>
        <p>Loading...</p>
      </div>
    </main>
  </div>
  <!-- User Modal -->
<div id="userModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 999; justify-content: center; align-items: center;">
  <div style="background: white; padding: 20px 30px; border-radius: 10px; width: 90%; max-width: 400px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); position: relative;">
    <h3 style="margin-top: 0;">Create User</h3>
    <button onclick="closeModal()" style="position: absolute; right: 15px; top: 15px; background: transparent; border: none; font-size: 20px; cursor: pointer;">&times;</button>
    <form id="userForm">
      <label>First Name</label><br>
      <input type="text" id="firstName" required style="width: 100%; padding: 6px; margin-bottom: 10px;"><br>
      <label>Last Name</label><br>
      <input type="text" id="lastName" required style="width: 100%; padding: 6px; margin-bottom: 10px;"><br>

      <label>Email</label><br>
      <input type="email" id="userEmail" required style="width: 100%; padding: 6px; margin-bottom: 10px;"><br>

      <label>Username</label><br>
      <input type="text" id="username" required style="width: 100%; padding: 6px; margin-bottom: 10px;"><br>

      <label>Telephone</label><br>
      <input type="text" id="userPhone" required style="width: 100%; padding: 6px; margin-bottom: 10px;"><br>


      <label>Password</label><br>
      <input type="password" id="userPassword" required style="width: 100%; padding: 6px; margin-bottom: 15px;"><br>

      <button type="submit" style="background: #28a745; color: white; border: none; padding: 10px; width: 100%; border-radius: 5px;">Create User</button>
    </form>
  </div>
</div>

  <script>
    let userId = '';
    let userTok = '';
    let datas
    document.addEventListener("DOMContentLoaded", async () => {
      console.log("JS is running ‚úÖ");

      // Your code here...

      const urlParams = new URLSearchParams(window.location.search);
      userId = urlParams.get("id") || localStorage.getItem("userId") || sessionStorage.getItem("userId");
      // userTok = urlParams.get("oven")



      const response = await fetch(`/api/v1/users/${userId}`, {
        method: "GET",
        headers: { "Content-Type": "application/json" },
        // body: JSON.stringify({ userId,userTok}),
      });

      datas = await response.json();
      localStorage.setItem(`profileId-${userId}`, datas.user.profilePictureId);
      localStorage.setItem('userId', datas.user._id);
      localStorage.setItem('userRole', datas.user.role);        // e.g. "admin" or "user"
      localStorage.setItem('username', datas.user.username);    // e.g. "BlessedJosh"

      // console.log(datas.user);
      async function FetchImage() {
        try {
          const userId = localStorage.getItem('userId');
          const profilePictureId = localStorage.getItem(`profileId-${userId}`);
          const userRole = localStorage.getItem('userRole');  // E.g. "admin" or "user"
          const username = localStorage.getItem('username');  // Store this after login
          // Set role/username beside avatar
          const roleTextEl = document.getElementById("user-role-text");
          if (userRole === 'admin') {
            roleTextEl.textContent = "Admin";
            roleTextEl.style.color = "#e74c3c"; // red for emphasis
          } else {
            roleTextEl.textContent = username || "User";
            roleTextEl.style.color = "#333";
          }

          if (!profilePictureId) {
            console.warn("Profile picture ID not found.");
            return;
          }
          if (datas.user.profilePictureId) {

            const response = await fetch(`/api/v1/uploadFiles/download/${profilePictureId}`);
            if (!response.ok) throw new Error("Failed to fetch profile image.");

            const blob = await response.blob();
            const imageURL = URL.createObjectURL(blob);

            document.getElementById("profile-pic").src = imageURL;
          }
        } catch (err) {
          console.error(err);
        }
        setTimeout(() => {
        }, 2000);
      }

      if (datas.user.profilePictureId) {

      }
      FetchImage();

      // let token = datas.cookie?datas.cookie.token : datas.userTok;
      // console.log(token);
      // console.log(userId);
      // if (!token) {
      //     window.location.href = "/api/v1/bundle/login"; // Redirect if not logged in
      //     return;
      // }
      console.log('Working with AfroDataGH');
    });
    const tableBody = document.getElementById("orderTable");
    let orders = []; // Global state


    // üü¢ Perform a bundle
    function performOrder(order) {
  const button = event.target;
  button.disabled = true;
  button.textContent = "Verifying...";

  const payload = {
    network: order.network.toLowerCase(),
    bundle: order.quantity,
    amount: String(order.price).replace("GHS ", ""),
    number: order.recipient,
    fundsource: order.recipient,
    selectedFSNetwork: order.network.toLowerCase()
  };

  fetch("/api/v1/muviin/initiate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
    .then(res => res.json())
    .then(data => {
      alert("Muviin Response:\n" + JSON.stringify(data, null, 2));
    })
    .catch(err => {
      console.error("Muviin error:", err);
      alert("Failed to perform order.");
    })
    .finally(() => {
      button.disabled = false;
      button.textContent = "Verify";
    });
}

    // üü¢ Fetch orders from your backend
    async function fetchOrders() {
      const spinner = document.getElementById("loadingSpinner");
      spinner.style.display = "block"; // Show spinner

      try {
        const res = await fetch("/api/v1/ordersdata");
        orders = await res.json();
        // console.log("Fetched orders:", orders);

        tableBody.innerHTML = "";
        orders.forEach(order => {
          const row = document.createElement("tr");
          row.innerHTML = `
          <td>${new Date(order.createdAt).toLocaleString()}</td>
          <td>${order.recipient}</td>
          <td>${order.quantity}</td>
          <td>${order.network}</td>
          <td>GHS ${order.price}</td>
          <td>
  <span class="badge ${order.payment === 'declined' ? 'status-declined' : 'status-pending'}">
    ${order.payment}
  </span>
  <button class="btn-perform" onclick='performOrder(${JSON.stringify(order)})' style="margin-left: 6px;">Verify</button>
</td>

          <td><span class="badge status-${order.status.toLowerCase()}">${order.status}</span></td>
          <td>${order.updated || ''}</td>
         <td>
  <select class="status-dropdown" data-order-id="${order._id}">
    <option value="Pending" ${order.status === "Pending" ? "selected" : ""}>Pending</option>
    <option value="Delivered" ${order.status === "Delivered" ? "selected" : ""}>Delivered</option>
    <option value="Failed" ${order.status === "Failed" ? "selected" : ""}>Failed</option>
  </select>
</td>


        `;
          tableBody.appendChild(row);
        });
        // ‚úÖ Bind change event to all dropdowns AFTER rendering
document.querySelectorAll(".status-dropdown").forEach(select => {
  select.addEventListener("change", async (e) => {
    const orderId = e.target.getAttribute("data-order-id");
    const newStatus = e.target.value;

    const res = await fetch(`/api/v1/ordersdata/${orderId}/status`, {
      method: "PATCH",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ status: newStatus })
    });

    const result = await res.json();
    if (res.ok) {
      // alert("Status updated to " + result.updatedOrder.status);
      fetchOrders(); // Refresh to reflect new status
    } else {
      // alert("Failed to update status: " + result.message);
      console.log(result.message)
    }
  });
});

      } catch (err) {
        console.error("Error fetching orders:", err);
        alert("Could not load orders.");
      } finally {
        spinner.style.display = "none"; // Hide spinner
      }
    }

    // üü¢ Download CSV dynamically from backend data
    async function downloadOrders() {
      try {
        const res = await fetch("/api/v1/ordersdata");
        orders = await res.json();
        console.log("Orders for CSV:", orders);
        const csv = orders.map(o =>
          [
            new Date(o.createdAt).toLocaleString(),
            String(o.recipient),
            o.quantity,
            o.network,
            "GHS " + o.price,
            o.payment,
            o.status,
            o.updated || ""
          ].join(",")
        ).join("\n");

        const blob = new Blob([csv], { type: "text/csv" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "mtn_orders.csv";
        a.click();
      } catch (err) {
        alert("Failed to download orders.");
        console.error(err);
      }
    }

    function bulkVerify() {
      alert("Bulk verification triggered.");
    }

    // ‚úÖ Load orders when page loads
    fetchOrders();
    function showSection(section) {
  const header = document.getElementById("section-header");

  document.getElementById("ordersSection").style.display = section === 'orders' ? 'block' : 'none';
  document.getElementById("usersSection").style.display = section === 'users' ? 'block' : 'none';

  if (section === 'orders') {
    header.textContent = "Orders";
    fetchOrders();
  } else if (section === 'users') {
    header.textContent = "Users";
    fetchUsers();
  }
}

    async function fetchUsers() {
      try {
        const res = await fetch(`/api/v1/users?limit=${5000000}`);
        const users = await res.json();
        console.log("Fetched users:", users);

        const tableBody = document.getElementById("userTable");
        tableBody.innerHTML = "";

        users.users.forEach(user => {
          const row = document.createElement("tr");
          row.innerHTML = `
        <td>${new Date(user.createdAt).toLocaleString()}</td>
        <td>${user.username}</td>
        <td>${user.email}</td>
        <td>${user.phone}</td>
        <td>Active</td>
        <td><button class="btn-download" onclick="deleteUser('${user._id}')">Delete</button></td>
      `;
          tableBody.appendChild(row);
        });
      } catch (err) {
        console.error("Failed to load users:", err);
      }
    }


    async function deleteUser(id) {
      const confirmed = confirm("Are you sure you want to delete this user?");
      if (!confirmed) return;

      try {
        const res=await fetch(`/api/v1/users/${id}`, { method: "DELETE" });
        const  data =await res.json()
        console.log("Delete response:", data);
        console.log(res)
        if (!res.ok) {
          throw new Error(data.msg);
        }
        alert("User deleted successfully!");
        fetchUsers(); // Refresh
      } catch (err) {
        console.log(err.message)
        alert(err.message||"Failed to delete user");
      }
    }
    document.querySelector(".hamburger").addEventListener("click", () => {
      const sidebar = document.querySelector("nav");
  const main = document.querySelector("main");

  main.classList.toggle("collapsed");
      sidebar.classList.toggle("collapsed");
    });
    document.querySelectorAll(".tabs button").forEach(button => {
      button.addEventListener("click", () => {
        document.querySelectorAll(".tabs button").forEach(btn => btn.classList.remove("active"));
        button.classList.add("active");
        const status = button.textContent.trim().toLowerCase();
        filterOrders(status);
      });
    });

    function filterOrders(status) {
      const filtered = status === "all" ? orders : orders.filter(o => o.status.toLowerCase() === status);
      renderOrders(filtered);
    }

    function renderOrders(data) {
      const tableBody = document.getElementById("orderTable");
      tableBody.innerHTML = "";
      data.forEach(order => {
        const row = document.createElement("tr");
        row.innerHTML = `
      <td>${new Date(order.createdAt).toLocaleString()}</td>
      <td>${order.recipient}</td>
      <td>${order.quantity}</td>
      <td>${order.network}</td>
      <td>${order.price}</td>
      <td>
  <span class="badge ${order.payment === 'declined' ? 'status-declined' : 'status-pending'}">
    ${order.payment}
  </span>
  <button class="btn-perform" onclick='performOrder(${JSON.stringify(order)})' style="margin-left: 6px;">Verify</button>
</td>

      <td><span class="badge status-${order.status.toLowerCase()}">${order.status}</span></td>
      <td>${order.updated}</td>
      <td>
  <select class="status-dropdown" data-order-id="${order._id}">
    <option value="Pending" ${order.status === "Pending" ? "selected" : ""}>Pending</option>
    <option value="Delivered" ${order.status === "Delivered" ? "selected" : ""}>Delivered</option>
    <option value="Failed" ${order.status === "Failed" ? "selected" : ""}>Failed</option>
  </select>
</td>

    `;
        tableBody.appendChild(row);
      });
    }
    document.querySelectorAll('.sidebar-menu li').forEach(item => {
      item.addEventListener('click', () => {
        document.querySelectorAll('.sidebar-menu li').forEach(el => el.classList.remove('active'));
        item.classList.add('active');
      });
    });

    document.querySelector('link[href*="font-awesome"]')
    function logout() {
      fetch(`/api/v1/auth/logout?userId=${userId}`, {
        method: "POST", // or POST if your backend is using POST
        credentials: "include" // include cookies
      })
        .then(res => {
          if (res.ok) {
            localStorage.removeItem(`token-${userId}`);
            localStorage.removeItem("userId");
            localStorage.removeItem(`datas-${userId}`);
            window.location.href = "/api/v1/bundle/login"; // Redirect to login

          } else {
            alert("Logout failed");
          }
        })
        .catch(err => {
          console.error("Logout error:", err);
          alert("Logout error");
        });
    }

    document.querySelectorAll(".status-dropdown").forEach(select => {
    select.addEventListener("change", async (e) => {
      const orderId = e.target.getAttribute("data-order-id");
      const newStatus = e.target.value;

      const res = await fetch(`/api/v1/orders/${orderId}/status`, {
        method: "PATCH",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ status: newStatus })
      });

      const result = await res.json();
      if (res.ok) {
        console.log(result.updatedOrder.status)
        // alert("Status updated to " + result.updatedOrder.status);
        fetchOrders();
      } else {
        // alert("Failed to update: " + result.message);
        console.log(result.message)
      }
    });
  });

  function showModal() {
    document.getElementById("userModal").style.display = "flex";
  }

  function closeModal() {
    document.getElementById("userModal").style.display = "none";
  }

  // üü¢ Create User from Admin Modal
  document.getElementById("userForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const firstName = document.getElementById("firstName").value.trim();
    const lastName = document.getElementById("lastName").value.trim();
    const email = document.getElementById("userEmail").value.trim();
    const username = document.getElementById("username").value.trim();
    const phone = document.getElementById("userPhone").value.trim();
    const password = document.getElementById("userPassword").value.trim();

    try {
      const res = await fetch("/api/v1/auth/signup", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          firstName,
          lastName,
          email,
          username,
          phone,
          password
        })
      });

      const result = await res.json();
      if (!res.ok) throw new Error(result.message || "Failed to create user");

      alert("‚úÖ User created successfully!");
      closeModal();
      fetchUsers(); // Reload the users table
    } catch (err) {
      console.error("‚ùå Error creating user:", err);
      alert("Error: " + err.message);
    }
  });
  function toggleSidebar() {
    const nav = document.querySelector('nav');
    nav.classList.toggle('active');
  }

  </script>

</body>

</html>